FROM ubuntu:22.04 AS builder
USER root
#Install dependencies for SDK
RUN apt-get update && apt-get install -y --no-install-recommends \
	python3 xz-utils perl file bash pkg-config qtcreator make \
	curl && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*
# Copy and execute the SDK installer
COPY fsl-imx-fides-glibc-x86_64-meta-toolchain-qt6-armv8a-imx93evk-toolchain-0.1.0.sh /tmp/install_sdk.sh
RUN chmod +x /tmp/install_sdk.sh && /tmp/install_sdk.sh -y -d /opt/sdk && \
    rm -f /tmp/install_sdk.sh

FROM ubuntu:22.04
#Install runtime dependencies
RUN apt-get update && \
    apt-get install -y --no-install-reommends bash file python3 xz-utils && \
    apt-get clean && rm -rf /var/lib/apt/lists/*
#Copy SDK from builder
COPY --from=builder /opt/sdk /opt/sdk
RUN useradd -m -s /bin/bash fidesuser && chown -R fidesuser:fidesuser /opt/sdk
USER fidesuser
# Source the SDK for every shell session
RUN echo "source /opt/sdk/environment-setup-armv8a-poky-linux" >> ~/.bashrc
